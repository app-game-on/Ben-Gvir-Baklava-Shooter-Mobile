<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Ben Gvir Shooter - Baklava Arcade Game</title>
    <meta name="description" content="Play Ben Gvir Shooter - The official arcade game. Shoot baklavas and climb the leaderboard!">
    <link rel="icon" type="image/png" href="baklava.png">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: none; }
        body { overflow: hidden; font-family: sans-serif; background: #1a1410; position: fixed; width: 100%; height: 100%; }
        #gameCanvas { display: block; }
        #loginScreen { position: absolute; inset: 0; background: #1a1410; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; }
        #loginScreen input { padding: 15px; font-size: 18px; border-radius: 8px; margin: 20px 0; width: 80%; max-width: 300px; text-align: center; border: none; }
        #loginScreen button { padding: 15px 40px; font-size: 20px; background: #ffcc00; border: none; border-radius: 8px; font-weight: bold; color: #000; }
        #ui { position: absolute; top: 10px; right: 10px; text-align: right; color: #fff; font-weight: bold; z-index: 10; pointer-events: none; text-shadow: 2px 2px 2px #000; }
        .topBtns { position: absolute; top: 15px; left: 15px; display: flex; gap: 10px; z-index: 50; }
        .controlBtn { width: 45px; height: 45px; background: rgba(255,255,255,0.2); border: 2px solid white; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; cursor: pointer; }
        #fireBtn { position: absolute; bottom: 40px; left: 25px; width: 95px; height: 95px; border-radius: 50%; background: rgba(255, 68, 68, 0.7); border: 3px solid white; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; z-index: 15; font-size: 20px; }
        #gameOver { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #fff; display: none; z-index: 60; background: rgba(0,0,0,0.95); padding: 20px; border-radius: 20px; border: 4px solid #ff4444; width: 90%; max-width: 400px; }
        .leaderboard { width: 100%; margin: 15px 0; border-collapse: collapse; font-size: 16px; }
        .leaderboard td { padding: 8px; border-bottom: 1px solid #333; }
        .gold { color: #ffcc00; font-weight: bold; }
        .actionBtn { margin: 5px; padding: 12px 25px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; display: inline-block; }
        #retryBtn { background: #ff4444; color: #fff; }
        #shareBtn { background: #25D366; color: #fff; }
    </style>
</head>
<body>

    <div class="topBtns">
        <div id="muteBtn" class="controlBtn">ðŸ”Š</div>
    </div>

    <div id="loginScreen">
        <h1 style="color:#ffcc00;">BEN GVIR SHOOTER</h1>
        <input type="text" id="usernameInput" placeholder="ENTER NAME..." maxlength="12">
        <button id="startBtn">PLAY GLOBAL</button>
    </div>

    <div id="ui">
        SCORE: <span id="score">0</span><br>
        <span style="color:#ffcc00">AMMO: <span id="ammo">3</span></span>
    </div>
    <div id="fireBtn">FIRE</div>

    <div id="gameOver">
        <h1 style="color: #ff4444;">WASTED</h1>
        <div id="finalScore" style="font-size: 22px; margin: 10px 0;"></div>
        <h3 style="color:#ffcc00;">GLOBAL TOP 5</h3>
        <table class="leaderboard"><tbody id="leaderboardBody"><tr><td>Connecting...</td></tr></tbody></table>
        <button id="retryBtn" class="actionBtn">RETRY</button>
        <button id="shareBtn" class="actionBtn">SHARE SCORE</button>
    </div>
    
    <canvas id="gameCanvas"></canvas>
    
    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz3JYh1ebRrvFZP0zNVLRcjtfv7wi7dZxMCb0uNOvtj7cSyE8FQVz9Dp_KOzFfg4H45/exec";
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const headImg = new Image(); headImg.src = 'photo1.png';
        const baklavaImg = new Image(); baklavaImg.src = 'baklava.png';
        const failSound = new Audio('fail_sound.mp3');

        let isMuted = false, username = "", gameRunning = false, loopId = null;
        let score = 0, ammo = 3, totalFrames = 0, flashOpacity = 0, shake = 0;
        let bombs = [], baklavas = [], particles = [], moveTarget = null;
        const player = { x: 0, y: 0 };

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            player.x = canvas.width / 2; player.y = canvas.height * 0.7;
        }
        window.addEventListener('resize', resize);
        resize();

        document.getElementById('shareBtn').onclick = () => {
            const shareText = `I just scored ${score} in Ben Gvir Shooter! Can you beat me?`;
            const shareUrl = "https://bengvirshooter.com";
            if (navigator.share) {
                navigator.share({ title: 'Ben Gvir Shooter', text: shareText, url: shareUrl });
            } else {
                window.open(`https://wa.me/?text=${encodeURIComponent(shareText + " " + shareUrl)}`, '_blank');
            }
        };

        async function syncGlobalScores(name, finalScore) {
            const body = document.getElementById('leaderboardBody');
            try {
                const response = await fetch(`${SCRIPT_URL}?name=${encodeURIComponent(name)}&score=${finalScore}`);
                const data = await response.json();
                body.innerHTML = "";
                data.forEach((entry, i) => {
                    body.innerHTML += `<tr class="${i === 0 ? 'gold' : ''}"><td>#${i+1}</td><td>${entry[0]}</td><td>${entry[1]}</td></tr>`;
                });
            } catch (err) { body.innerHTML = "<tr><td>Error syncing.</td></tr>"; }
        }

        function runGame() {
            if (loopId) cancelAnimationFrame(loopId);
            gameRunning = true; score = 0; ammo = 3; totalFrames = 0;
            bombs = []; baklavas = []; particles = [];
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'none';
            gameLoop();
        }

        document.getElementById('startBtn').onclick = () => {
            username = document.getElementById('usernameInput').value.trim().toUpperCase() || "PLAYER";
            runGame();
        };
        document.getElementById('retryBtn').onclick = runGame;

        canvas.addEventListener('touchmove', (e) => { 
            if(gameRunning) {
                e.preventDefault(); 
                moveTarget = { x: e.touches[0].clientX, y: e.touches[0].clientY };
            }
        }, {passive: false});

        document.getElementById('fireBtn').addEventListener('touchstart', (e) => {
            if (gameRunning && ammo > 0) {
                baklavas.push({ x: player.x, y: player.y - 20 });
                ammo--; document.getElementById('ammo').innerText = ammo;
            }
        });

        function triggerDeath() {
            gameRunning = false;
            if(!isMuted) failSound.play().catch(()=>{});
            document.getElementById('finalScore').innerText = "SCORE: " + score;
            document.getElementById('gameOver').style.display = 'block';
            syncGlobalScores(username, score);
        }

        function update() {
            if (!gameRunning) return;
            totalFrames++;
            if (totalFrames % 400 === 0) { ammo++; document.getElementById('ammo').innerText = ammo; }

            if (moveTarget) {
                player.x += (moveTarget.x - player.x) * 0.3;
                player.y += (moveTarget.y - 40 - player.y) * 0.3;
            }

            // --- DIFFICULTY SCALING (500 POINTS) ---
            let difficultyMultiplier = Math.pow(1.25, Math.floor(score / 500));
            let currentSpawnRate = Math.max(4, Math.floor(20 / difficultyMultiplier));

            if (totalFrames % currentSpawnRate === 0) {
                bombs.push({ x: Math.random() * (canvas.width - 40), y: -50 });
            }

            bombs.forEach((b, i) => {
                b.y += 6 + (score / 2000);
                if (Math.abs(b.x + 20 - player.x) < 30 && Math.abs(b.y + 20 - player.y) < 50) triggerDeath();
                if (b.y > canvas.height) { bombs.splice(i, 1); score += 10; }
            });

            baklavas.forEach((b, bi) => {
                b.y -= 10;
                bombs.forEach((bomb, mi) => {
                    if (Math.abs(b.x - (bomb.x + 20)) < 40 && Math.abs(b.y - (bomb.y + 20)) < 40) { 
                        bombs.splice(mi, 1); baklavas.splice(bi, 1); 
                        score += 50; 
                    }
                });
            });
            document.getElementById('score').innerText = score;
        }

        function draw() {
            ctx.fillStyle = '#1a1410'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            if (gameRunning) {
                ctx.drawImage(headImg, player.x - 25, player.y - 25, 50, 50);
            }
            bombs.forEach(b => {
                ctx.fillStyle = '#000'; ctx.beginPath(); ctx.arc(b.x+20, b.y+20, 20, 0, Math.PI*2); ctx.fill();
            });
            baklavas.forEach(b => ctx.drawImage(baklavaImg, b.x - 20, b.y - 20, 40, 40));
        }

        function gameLoop() {
            update(); draw();
            loopId = requestAnimationFrame(gameLoop);
        }
    </script>
</body>
</html>
