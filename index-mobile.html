     <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Baklava Shooter Global</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: none; }
        body { overflow: hidden; font-family: sans-serif; background: #1a1410; position: fixed; width: 100%; height: 100%; }
        #gameCanvas { display: block; }
        #loginScreen { position: absolute; inset: 0; background: #1a1410; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; }
        #loginScreen input { padding: 15px; font-size: 18px; border-radius: 8px; margin: 20px 0; width: 80%; max-width: 300px; text-align: center; border: none; }
        #loginScreen button { padding: 15px 40px; font-size: 20px; background: #ffcc00; border: none; border-radius: 8px; font-weight: bold; color: #000; }
        #ui { position: absolute; top: 10px; right: 10px; text-align: right; color: #fff; font-weight: bold; z-index: 10; pointer-events: none; text-shadow: 2px 2px 2px #000; }
        #muteBtn { position: absolute; top: 15px; left: 15px; width: 45px; height: 45px; background: rgba(255,255,255,0.2); border: 2px solid white; border-radius: 8px; display: flex; align-items: center; justify-content: center; z-index: 50; font-size: 24px; color: white; cursor: pointer; }
        #fireBtn { position: absolute; bottom: 40px; left: 25px; width: 95px; height: 95px; border-radius: 50%; background: rgba(255, 68, 68, 0.7); border: 3px solid white; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; z-index: 15; font-size: 20px; }
        #gameOver { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #fff; display: none; z-index: 20; background: rgba(0,0,0,0.95); padding: 20px; border-radius: 20px; border: 4px solid #ff4444; width: 90%; max-width: 400px; }
        .leaderboard { width: 100%; margin: 15px 0; border-collapse: collapse; font-size: 16px; }
        .leaderboard td { padding: 8px; border-bottom: 1px solid #333; }
        .gold { color: #ffcc00; font-weight: bold; }
        #gameOver button { margin-top: 10px; padding: 12px 25px; background: #ff4444; color: #fff; border: none; border-radius: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <div id="muteBtn">ðŸ”Š</div>

    <div id="loginScreen">
        <h1 style="color:#ffcc00;">BAKLAVA SHOOTER</h1>
        <input type="text" id="usernameInput" placeholder="ENTER NAME..." maxlength="12">
        <button id="startBtn">PLAY GLOBAL</button>
    </div>

    <div id="ui">SCORE: <span id="score">0</span><br><span style="color:#ffcc00">AMMO: <span id="ammo">3</span></span></div>
    <div id="fireBtn">FIRE</div>

    <div id="gameOver">
        <h1 style="color: #ff4444;">WASTED</h1>
        <div id="finalScore" style="font-size: 22px; margin: 10px 0;"></div>
        <h3 style="color:#ffcc00;">GLOBAL TOP 5</h3>
        <table class="leaderboard"><tbody id="leaderboardBody"><tr><td>Connecting to Google...</td></tr></tbody></table>
        <button id="retryBtn">RETRY</button>
    </div>
    
    <canvas id="gameCanvas"></canvas>
    
    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz3JYh1ebRrvFZP0zNVLRcjtfv7wi7dZxMCb0uNOvtj7cSyE8FQVz9Dp_KOzFfg4H45/exec";

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const headImg = new Image(); headImg.src = 'photo1.png';
        const baklavaImg = new Image(); baklavaImg.src = 'baklava.png';
        const failSound = new Audio('fail_sound.mp3');

        let isMuted = false;
        let username = "", gameRunning = false, loopId = null;
        let score = 0, ammo = 3, totalFrames = 0, flashOpacity = 0, shake = 0;
        let bombs = [], baklavas = [], particles = [], moveTarget = null;
        const player = { x: 0, y: 0, walkCycle: 0 };

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            player.x = canvas.width / 2; player.y = canvas.height * 0.7;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- MUTE LOGIC ---
        document.getElementById('muteBtn').onclick = (e) => {
            isMuted = !isMuted;
            document.getElementById('muteBtn').innerText = isMuted ? "ðŸ”‡" : "ðŸ”Š";
            document.getElementById('muteBtn').style.color = isMuted ? "#ff4444" : "white";
            e.stopPropagation();
        };

        async function syncGlobalScores(name, finalScore) {
            const body = document.getElementById('leaderboardBody');
            try {
                const response = await fetch(`${SCRIPT_URL}?name=${encodeURIComponent(name)}&score=${finalScore}`);
                const data = await response.json();
                body.innerHTML = "";
                if (data.length === 0) {
                    body.innerHTML = "<tr><td>No scores yet!</td></tr>";
                } else {
                    data.forEach((entry, i) => {
                        body.innerHTML += `<tr class="${i === 0 ? 'gold' : ''}">
                            <td>#${i+1}</td><td>${entry[0]}</td><td>${entry[1]}</td>
                        </tr>`;
                    });
                }
            } catch (err) {
                body.innerHTML = "<tr><td>Error syncing scores.</td></tr>";
            }
        }

        function runGame() {
            if (loopId) cancelAnimationFrame(loopId);
            gameRunning = true;
            score = 0; ammo = 3; totalFrames = 0; flashOpacity = 0; shake = 0;
            bombs = []; baklavas = []; particles = [];
            document.getElementById('score').innerText = "0";
            document.getElementById('ammo').innerText = "3";
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'none';
            gameLoop();
        }

        document.getElementById('startBtn').onclick = () => {
            username = document.getElementById('usernameInput').value.trim().toUpperCase() || "PLAYER";
            runGame();
        };

        document.getElementById('retryBtn').onclick = () => { runGame(); };

        canvas.addEventListener('touchstart', (e) => { moveTarget = { x: e.touches[0].clientX, y: e.touches[0].clientY }; });
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); moveTarget = { x: e.touches[0].clientX, y: e.touches[0].clientY }; }, {passive: false});
        canvas.addEventListener('touchend', () => { moveTarget = null; });

        document.getElementById('fireBtn').addEventListener('touchstart', (e) => {
            e.stopPropagation();
            if (gameRunning && ammo > 0) {
                baklavas.push({ x: player.x, y: player.y - 20 });
                ammo--; document.getElementById('ammo').innerText = ammo;
            }
        });

        function triggerDeath() {
            gameRunning = false;
            flashOpacity = 1.0; shake = 30;
            if(!isMuted) failSound.play().catch(()=>{});
            for(let i=0; i<100; i++) {
                particles.push({ x: player.x, y: player.y, vx: (Math.random()-0.5)*40, vy: (Math.random()-0.5)*40, life: 60, size: Math.random()*10, color: i%3==0?'#f40':(i%3==1?'#fc0':'#fff') });
            }
            document.getElementById('finalScore').innerText = "SCORE: " + score;
            document.getElementById('gameOver').style.display = 'block';
            document.getElementById('leaderboardBody').innerHTML = "<tr><td>Updating Global Board...</td></tr>";
            syncGlobalScores(username, score);
        }

        function update() {
            if (shake > 0) shake *= 0.85;
            if (flashOpacity > 0) flashOpacity -= 0.04;
            particles.forEach((p, i) => { p.x += p.vx; p.y += p.vy; p.life--; if (p.life <= 0) particles.splice(i, 1); });
            if (!gameRunning) return;
            
            totalFrames++;

            if (totalFrames % 360 === 0) { 
                ammo++; 
                document.getElementById('ammo').innerText = ammo; 
            }

            if (moveTarget) {
                player.x += (moveTarget.x - player.x) * 0.45;
                player.y += (moveTarget.y - 40 - player.y) * 0.45;
                player.walkCycle += 0.35;
            }

            // Bomb Spawn Logic: Pushed more to sides
            if (totalFrames % 16 === 0) {
                const bombSize = 40;
                // Bias the random to hit the edges more often
                let randomX;
                if(Math.random() < 0.4) {
                    // 40% chance to spawn specifically in the side 15% of the screen
                    randomX = Math.random() < 0.5 ? Math.random() * (canvas.width * 0.15) : canvas.width - (Math.random() * (canvas.width * 0.15)) - bombSize;
                } else {
                    randomX = Math.random() * (canvas.width - bombSize);
                }
                bombs.push({ x: randomX, y: -60 });
            }

            bombs.forEach((b, i) => {
                b.y += 5.5;
                if (Math.abs(b.x + 20 - player.x) < 35 && Math.abs(b.y + 20 - player.y) < 65) triggerDeath();
                if (b.y > canvas.height) { bombs.splice(i, 1); score += 10; }
            });

            baklavas.forEach((b, bi) => {
                b.y -= 12; // SLOWER BAKLAVA (was 22)
                bombs.forEach((bomb, mi) => {
                    if (Math.abs(b.x - (bomb.x + 20)) < 40 && Math.abs(b.y - (bomb.y + 20)) < 40) { 
                        bombs.splice(mi, 1); 
                        baklavas.splice(bi, 1); 
                        score += 100; 
                    }
                });
            });
            document.getElementById('score').innerText = score;
        }

        function draw() {
            ctx.save();
            if (shake > 1) ctx.translate(Math.random()*shake - shake/2, Math.random()*shake - shake/2);
            ctx.fillStyle = '#3d3329'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            if (gameRunning) {
                const sw = Math.sin(player.walkCycle) * 18;
                ctx.strokeStyle = '#E6B5AC'; ctx.lineWidth = 5; ctx.lineCap = 'round';
                ctx.drawImage(headImg, player.x - 25, player.y - 25, 50, 50);
                ctx.beginPath();
                ctx.moveTo(player.x, player.y + 25); ctx.lineTo(player.x, player.y + 60);
                ctx.moveTo(player.x, player.y + 40); ctx.lineTo(player.x - 25, player.y + 50 + sw);
                ctx.moveTo(player.x, player.y + 40); ctx.lineTo(player.x + 25, player.y + 50 - sw);
                ctx.moveTo(player.x, player.y + 60); ctx.lineTo(player.x - 15, player.y + 90 + sw);
                ctx.moveTo(player.x, player.y + 60); ctx.lineTo(player.x + 15, player.y + 90 - sw);
                ctx.stroke();
            }
            bombs.forEach(b => {
                ctx.fillStyle = '#000'; ctx.beginPath(); ctx.arc(b.x+20, b.y+20, 20, 0, Math.PI*2); ctx.fill();
                ctx.strokeStyle = '#a67c52'; ctx.lineWidth = 4; ctx.beginPath();
                ctx.moveTo(b.x+20, b.y+5); ctx.quadraticCurveTo(b.x+30, b.y-15, b.x+40, b.y-5); ctx.stroke();
                ctx.fillStyle = totalFrames % 4 < 2 ? '#ff0' : '#f40';
                ctx.beginPath(); ctx.arc(b.x+40, b.y-5, 6, 0, Math.PI*2); ctx.fill();
            });
            baklavas.forEach(b => ctx.drawImage(baklavaImg, b.x - 22, b.y - 22, 45, 45));
            particles.forEach(p => { ctx.fillStyle = p.color; ctx.globalAlpha = p.life / 60; ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill(); });
            ctx.restore();
            if (flashOpacity > 0) { ctx.fillStyle = `rgba(255,255,255,${flashOpacity})`; ctx.fillRect(0,0,canvas.width, canvas.height); }
        }

        function gameLoop() {
            update();
            draw();
            loopId = requestAnimationFrame(gameLoop);
        }
    </script>
</body>
</html> 
